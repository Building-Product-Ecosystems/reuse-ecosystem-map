{"version":3,"sources":["webpack:///./src/data_constants.js","webpack:///./src/map.js","webpack:///./src/table.js","webpack:///./src/data.js","webpack:///./src/index.js"],"names":["LAT_COL","LON_COL","ROLE_COL","COLOR_COL","BASE_TABLE_CONFIG","name","fields","view","COLORS_TABLE_CONFIG","geoJSON","map","INITIAL_COORDS","isMobile","window","innerHeight","innerWidth","init","data","featureCollection","i","length","feature","replace","lon","lat","match","parseDMS","isNaN","parseFloat","built","buildFeature","push","e","console","log","buildGeoJSON","features","L","center","zoom","scrollWheelZoom","zoomControl","position","addTo","maxZoom","attribution","id","pointsLayers","pointToLayer","latlng","radius","fillColor","getFeatureColor","properties","color","weight","opacity","fillOpacity","onEachFeature","layer","prop","display","text","bindPopup","maxWidth","bindTooltip","fitBounds","getBounds","loadMap","setTimeout","document","getElementById","style","colorCol","featureObject","geometry","coordinates","input","parts","split","degrees","minutes","seconds","direction","dd","parseInt","convertDMSToDD","mapLegend","colors","colorsHTML","join","elementId","$","dataTable","ext","errMode","table","DataTable","responsive","paging","lengthChange","order","columns","title","className","render","type","full","meta","regions","item","REGION","filter","ar","indexOf","unshift","appendTo","regionSelect","each","append","attr","this","on","selectValue","value","searchValue","column","search","draw","toLowerCase","base","Airtable","apiKey","getAirtableRecords","a","Promise","resolve","reject","allRecords","select","maxRecords","eachPage","records","fetchNextPage","r","err","getAirtableData","mainData","colorsData","d","obj","find","c","app","querySelector","parentUrl","location","parent","referrer","href","hideTable","innerHTML","Data","airtableData","Map","Table","mapLegendShow","mapLegendHide","mapLegendContent","querySelectorAll","onclick","classList","add","remove","forEach","div","addEventListener"],"mappings":"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","file":"app.5eb3460e.js","sourcesContent":["export const LAT_COL = 'Latitude'\nexport const LON_COL = 'Longitude'\nexport const ENTITY_COL = \"Entity Name\"\nexport const LOCATION_COL = \"Region\"\nexport const ROLE_COL = \"Primary Role\"\nexport const SECONDARY_ROLE_COL = \"Secondary Role (if applicable)\"\nexport const ADDRESS_COL = \"Full Address\"\nexport const CONTACT_COL = \"Contact Name\"\nexport const EMAIL_COL = \"Email\"\nexport const PHONE_COL = \"Phone Number\"\nexport const WEBSITE_COL = \"Website\"\nexport const COLLABORATION_COL = \"Collaboration Opportunities\"\nexport const COLOR_COL = \"Colors (HEX) (from Primary Role copy)\"\n\nexport const ALL_FIELDS = [\n  LAT_COL,\n  LON_COL,\n  ENTITY_COL,\n  LOCATION_COL,\n  ROLE_COL,\n  SECONDARY_ROLE_COL,\n  ADDRESS_COL,\n  CONTACT_COL,\n  EMAIL_COL,\n  PHONE_COL,\n  WEBSITE_COL,\n  COLLABORATION_COL,\n  COLOR_COL,\n]\n\nexport const BASE_TABLE_CONFIG = {\n  name: 'data',\n  fields: ALL_FIELDS,\n  view: 'View for map'\n}\n\nexport const C_ROLE_COL = \"Role\"\nexport const C_COLOR_COL = \"Colors (HEX)\"\nexport const C_RECORD_ID_COL = \"record_id\"\n\nexport const COLORS_TABLE_CONFIG = {\n  name: 'Role Colors',\n  fields: [C_ROLE_COL, C_COLOR_COL, C_RECORD_ID_COL],\n  view: 'Grid view'\n}\n","import * as L from 'leaflet'\n\nimport {\n  LON_COL,\n  LAT_COL,\n  ENTITY_COL,\n  LOCATION_COL,\n  ROLE_COL,\n  ADDRESS_COL,\n  CONTACT_COL,\n  EMAIL_COL,\n  PHONE_COL,\n  WEBSITE_COL,\n  COLLABORATION_COL,\n  COLOR_COL,\n} from './data_constants.js'\n\nconst MAPBOX_LINK = 'https://api.mapbox.com/styles/v1/bpemaps/ckyt7sb63000d14qmztb6jew3/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoiYnBlbWFwcyIsImEiOiJja3l0N25wMzkxN2F1MnVzajJ4N2tlNG9sIn0.hHHFVHuiYWIuSFf7osJfaA'\n\nconst INITIAL_COORDS = [37.76496739271615, -122.39985495803376]\nconst INITIAL_ZOOM = 5\nconst isMobile = window.innerHeight >= window.innerWidth\n\nexport {\n  init,\n  mapLegend,\n  zoomToRegion,\n}\n\nlet geoJSON\nlet map\n\nfunction init(data) {\n  geoJSON = buildGeoJSON(data)\n  console.log(data)\n  console.log(geoJSON)\n  console.log(data.length, 'rows received')\n  console.log(geoJSON.features.length, 'rows parsed')\n  loadMap(geoJSON)\n  setTimeout(function(){\n    document.getElementById('spinner').style.display = 'none'\n  }, 350)\n}\n\nfunction getFeatureColor(colorCol) {\n  const fallbackColor = '#333'\n  if (!colorCol.length) { return fallbackColor }\n  return colorCol[0]\n}\n\nfunction buildFeature(feature) {\n  let featureObject = {\n    \"type\": \"Feature\",\n    \"properties\": feature,\n    \"geometry\": {\n      \"type\": \"Point\",\n      \"coordinates\": []\n    }\n  }\n  // for (let variable in feature) {\n  //   if (feature.hasOwnProperty(variable)) {\n  //     featureObject.properties[variable.trim()] = feature[variable].trim()\n  //   }\n  // }\n  featureObject.geometry.coordinates.push(parseFloat(feature[LON_COL]))\n  featureObject.geometry.coordinates.push(parseFloat(feature[LAT_COL]))\n  return featureObject\n}\n\nfunction buildGeoJSON(data) {\n  let featureCollection = {\n    \"type\": \"FeatureCollection\",\n    \"features\": []\n  }\n  for (var i = 0; i < data.length; i++) {\n    let feature = data[i]\n    if (!feature[LON_COL] || !feature[LAT_COL]) { continue }\n    feature[LON_COL] = feature[LON_COL].replace(',', '.')\n    feature[LAT_COL] = feature[LAT_COL].replace(',', '.')\n    let lon = feature[LON_COL]\n    let lat = feature[LAT_COL]\n    if (lon.match(/[a-z]/i) && lat.match(/[a-z]/i)) {\n      feature[LON_COL] = parseDMS(feature[LON_COL])\n      feature[LAT_COL] = parseDMS(feature[LAT_COL])\n    }\n    try {\n      if (isNaN(parseFloat(lon)) == false && isNaN(parseFloat(lat)) == false) {\n        let built = buildFeature(feature)\n        featureCollection['features'].push(built)\n      }\n    } catch (e) {\n        console.log('error parsing row', i, feature, e)\n    }\n  }\n  return featureCollection\n}\n\nfunction loadMap(geoJSON) {\n  map = L.map('map', {\n    center: INITIAL_COORDS,\n    zoom: INITIAL_ZOOM,\n    scrollWheelZoom: false,\n    zoomControl: false,\n  })\n\n  L.control.zoom({\n    position: 'bottomleft'\n  }).addTo(map);\n\n  L.tileLayer(MAPBOX_LINK, {\n    maxZoom: 18,\n    attribution: 'Map data &copy <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, ' +\n      '<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ' +\n      'Imagery Â© <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n    id: 'mapbox.light'\n  }).addTo(map)\n\n  function popup(feature, layer) {\n    let prop = feature.properties\n\n    const display = (text) => { return text ? text : '' }\n\n    layer.bindPopup(`\n      <div class=\"popup\">\n        <h2>${prop[ENTITY_COL]}</h2>\n        ${prop[LOCATION_COL] ? `<h4>${prop[LOCATION_COL]}</h4>` : ''}\n        <hr/>\n        <table class=\"popup-table\">\n          <tbody>\n            <tr><td><strong>Role(s)</strong></td><td>${display(prop[ROLE_COL])}</td></tr>\n            <tr><td><strong>Address</strong></td><td>${display(prop[ADDRESS_COL])}</td></tr>\n            <tr><td><strong>Contact</strong></td><td>${display(prop[CONTACT_COL])}</td></tr>\n            <tr><td><strong>Email</strong></td><td><a href=\"mailto:${display(prop[EMAIL_COL])}\">${display(prop[EMAIL_COL])}</a></td></tr>\n            <tr><td><strong>Phone</strong></td><td><a href=\"tel:${display(prop[PHONE_COL])}\">${display(prop[PHONE_COL])}</a></td></tr>\n            <tr><td><strong>Website</strong></td><td><a href=\"${display(prop[WEBSITE_COL])}\" target=\"_blank\">${display(prop[WEBSITE_COL])}</a></td></tr>\n          </tbody>\n        </table>\n        <p class=\"popup-p\"><strong>Collaboration Opportunities: </strong>${display(prop[COLLABORATION_COL])}</p>\n      </div>\n      `, {\n        maxWidth : isMobile ? window.innerWidth * 0.75 : 450\n      })\n\n    layer.bindTooltip(`\n      <div class=\"tooltip\">\n        <strong style=\"font-size: 1.25em;\">${prop[ENTITY_COL]}</strong>\n        ${prop[LOCATION_COL] ? `<br /><span>${prop[LOCATION_COL]}</span>` : ''}\n      </div>\n      `, {\n        maxWidth : isMobile ? window.innerWidth * 0.75 : 250\n      })\n  }\n\n  const pointsLayers = L.geoJSON(geoJSON, {\n\n    pointToLayer: function(feature, latlng) {\n      return L.circleMarker(latlng, {\n        radius: 5,\n        fillColor: getFeatureColor(feature.properties[COLOR_COL]),\n        color: \"#fff\",\n        weight: 1.2,\n        opacity: 1,\n        fillOpacity: 0.9,\n      })\n    },\n    onEachFeature: popup\n  }).addTo(map)\n\n  map.fitBounds(pointsLayers.getBounds())\n}\n\nfunction zoomToRegion(regionName) {\n  if (regionName.toLowerCase() === 'all') {\n    map.fitBounds(L.geoJSON(geoJSON).getBounds())\n    return\n  }\n  // const filteredData = geoJSON.features.filter(row => row.properties['REGION'] === regionName)\n  // if (filteredData) {\n  //   map.fitBounds(L.geoJSON(filteredData).getBounds())\n  // }\n}\n\n// https://stackoverflow.com/questions/1140189/converting-latitude-and-longitude-to-decimal-values\nfunction parseDMS(input) {\n    let parts = input.split(/[^\\d\\w\\.]+/)\n    return convertDMSToDD(parts[0], parts[1], parts[2], parts[3])\n}\n\nfunction convertDMSToDD(degrees, minutes, seconds, direction) {\n    let dd = parseInt(degrees) + parseInt(minutes)/60 + parseInt(seconds)/(60*60)\n\n    if (direction == \"S\" || direction == \"W\") {\n        dd = dd * -1\n    }\n    return dd\n}\n\nfunction mapLegend(colors) {\n  const colorsHTML = [`\n    <div id=\"map-legend-show\" class=\"map-legend-row map-legend-icon flex ${isMobile ? 'visible' : 'invisible'}\">\n      <span>See Legend</span>\n    </div>\n    <div id=\"map-legend-hide\" class=\"map-legend-row map-legend-icon flex ${isMobile ? 'invisible' : 'visible'}\">\n      <span>Hide Legend</span>\n    </div>\n  `]\n  for (const color of colors) {\n    colorsHTML.push(`\n      <div class=\"map-legend-row map-legend-content flex ${isMobile ? 'invisible' : 'visible'}\">\n        <div class=\"map-legend-color\" style=\"background: ${color[1]}\"></div>\n        <span>${color[0]}</span>\n      </div>\n    `)\n  }\n  return `<div class=\"map-legend flex flex-column\">${colorsHTML.join('\\n')}</div>`\n}\n","// var $ = require( 'jquery' )\n// var dt = require( 'datatables.net' )( window, $ )\nimport * as $ from 'jquery'\nimport * as dt from 'datatables.net'\nimport * as dtResponsive from 'datatables.net-responsive'\nimport { zoomToRegion } from './map.js'\n\nimport {\n  ENTITY_COL,\n  LOCATION_COL,\n  ROLE_COL,\n  SECONDARY_ROLE_COL,\n  ADDRESS_COL,\n  CONTACT_COL,\n  EMAIL_COL,\n  PHONE_COL,\n  WEBSITE_COL,\n  COLLABORATION_COL,\n} from './data_constants.js'\n\nexport {\n  init\n}\n\nfunction init(data, elementId) {\n  $.fn.dataTable.ext.errMode = 'none';  // suppress errors\n\n  // for (var i = 0; i < data.length; i++) {\n  //   let row = data[i]\n  //   if (row[LOCATION_COL]) {\n  //       row[ENTITY_COL] = row[ENTITY_COL] + ' - ' + row[LOCATION_COL]\n  //   }\n  // }\n  const table = $(elementId).DataTable({\n    data: data,\n    responsive: true,\n    // scrollY: '510px',\n    // scrollCollapse: true,\n    paging: true,\n    lengthChange: false,\n    order: [[ 0, \"asc\" ]],\n    columns: [\n      {\n        data: ENTITY_COL,\n        title: 'ENTITY:',\n        className: 'details-col',\n        render: function(data, type, full, meta) {\n          return `<span class=\"details-link\">${data}</span>`\n        }\n      },\n      // {\n      //   data: LOCATION_COL,\n      //   title: 'LOCATION:',\n      // },\n      {\n        data: ROLE_COL,\n        title: 'PRIMARY ROLE:',\n      },\n      {\n        data: SECONDARY_ROLE_COL,\n        title: 'SECONDARY ROLE:',\n      },\n      {\n        data: LOCATION_COL,\n        name: 'REGION',\n        title: 'REGION:',\n      },\n      {\n        data: ADDRESS_COL,\n        title: 'ADDRESS:',\n        className: 'none',\n      },\n      {\n        data: CONTACT_COL,\n        title: 'CONTACT:',\n        className: 'none',\n      },\n      {\n        data: EMAIL_COL,\n        title: 'EMAIL:',\n        className: 'none',\n        render: function(data, type, full, meta) {\n          return `<a href=\"mailto:${data}\">${data}</a>`\n        }\n      },\n      {\n        data: PHONE_COL,\n        title: 'PHONE:',\n        className: 'none',\n        render: function(data, type, full, meta) {\n          return `<a href=\"tel:${data}\">${data}</a>`\n        }\n      },\n      {\n        data: WEBSITE_COL,\n        title: 'WEBSITE:',\n        className: 'none',\n        render: function(data, type, full, meta) {\n          return `<a href=\"${data}\" target=\"_blank\">${data}</a>`\n        }\n      },\n      {\n        data: COLLABORATION_COL,\n        title: 'COLLABORATION OPPORTUNITIES:',\n        className: 'none',\n      },\n    ]\n  })\n\n  // add filter for regions, if there are more than 1\n  const allRegions = data.map(item => item.REGION)\n  const regions = allRegions.filter((item, i, ar) => ar.indexOf(item) === i)\n  if (regions.length > 1) {\n    regions.unshift('All')\n\n    $('<span><strong>Zoom to a region: </strong>&nbsp;</span>').appendTo('#regionSelectDiv')\n\n    var regionSelect = $('<select id=\"regionSelect\">').appendTo('#regionSelectDiv')\n    $(regions).each(function() {\n     regionSelect.append($('<option>').attr('value', this).text(this))\n    })\n\n    regionSelect.on('change', function() {\n      const selectValue = this.value\n      const searchValue = selectValue === 'All' ? '' : selectValue\n      table\n        .column('REGION:name')\n        .search(searchValue)\n        .draw()\n      zoomToRegion(selectValue)\n    })\n  }\n\n}\n","import * as Papa from 'papaparse'\nimport Airtable from \"airtable\";\nimport * as Map from './map.js'\nimport * as Table from './table.js'\n\nimport {\n  BASE_TABLE_CONFIG,\n  COLORS_TABLE_CONFIG,\n  ROLE_COL,\n  SECONDARY_ROLE_COL,\n  C_ROLE_COL,\n  C_COLOR_COL,\n  C_RECORD_ID_COL,\n} from './data_constants.js'\n\nconst databaseId = 'app2Ufltjsi6qQF2b';\nconst airtableApiKey = 'keyXTEWIgSJI4MeGu';\nconst base = new Airtable({apiKey: airtableApiKey}).base(databaseId);\n\nconst publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSZ_aRgmKOVqj1Ch4zy8zzjkQREuYo0xXzPlJUKv4-7ULfWNNQdJbOFJgVFayS4zbT7vvkIaJ5JZaBa/pub?output=csv'\n\nexport {\n  getAirtableData,\n  getSpreadsheetData,\n}\n\nconst getAirtableRecords = async ({\n  name,\n  fields,\n  view\n}) => {\n  return new Promise((resolve, reject) => {\n    let allRecords = [];\n\n    base(name).select({\n      maxRecords: 500,\n      view: view,\n      fields: fields,\n     })\n      .eachPage(\n        (records, fetchNextPage) => {\n          allRecords = [\n            ...allRecords,\n            ...records.map(r => r.fields)\n          ];\n          fetchNextPage();\n        },\n        err => {\n          if (err) reject(err);\n          resolve(allRecords);\n        }\n      );\n  });\n}\n\nconst getAirtableData = async () => {\n  let mainData = await getAirtableRecords(BASE_TABLE_CONFIG)\n  let colorsData = await getAirtableRecords(COLORS_TABLE_CONFIG)\n\n  // join main data to colors to find role names\n  mainData = mainData.map(d => {\n    const obj = {...d}\n    obj[ROLE_COL] = obj[ROLE_COL].map(r => colorsData.find(c => c?.[C_RECORD_ID_COL] === r)?.[C_ROLE_COL])\n    obj[SECONDARY_ROLE_COL] = obj[ROLE_COL].map(r => colorsData.find(c => c?.[C_RECORD_ID_COL] === r)?.[C_ROLE_COL])\n    return obj\n  })\n\n  colorsData = colorsData.map(d => [d[C_ROLE_COL], d[C_COLOR_COL]])\n  return [mainData, colorsData]\n};\n\nfunction getSpreadsheetData() {\n  Papa.parse(publicSpreadsheetUrl, {\n  download: true,\n  header: true,\n  complete: function(results) {\n      const data = results.data\n      const publishedData = data.filter(function(obj){\n        if ('STATUS' in obj) {\n          return obj['STATUS'].trim().toLowerCase() == 'published'\n        }\n      })\n      Map.init(publishedData)\n      Table.init(publishedData, '#table')\n    }\n  })\n}\n","import * as Data from './data.js'\nimport * as Map from './map.js'\nimport * as Table from './table.js'\nimport style from './style/main.scss'\n\nconst app = document.querySelector('#app')\nconst parentUrl = (window.location != window.parent.location) ? document.referrer : document.location.href\n\nconst hideTable = window.location.href.indexOf(\"table=hide\") > 0\n\napp.innerHTML = `\n<div id=\"spinner\">\n  <div class=\"spinner-grow text-secondary\" role=\"status\">\n    <span class=\"sr-only\">Loading...</span>\n  </div>\n</div>\n<div id=\"map\"></div>\n<a href=\"https://www.buildingproductecosystems.org/\" target=\"_blank\">\n  <img src=\"images/bpe-logo.png\" alt=\"Building Product Ecosystems\" id=\"mapLogo\"></img>\n</a>\n<div id=\"mapLegend\"></div>\n<div id=\"regionSelectDiv\"></div>\n\n<div class=\"credits\" style=\"display: ${hideTable ? \"none\" : \"block\"}\">\n  ${parentUrl.indexOf(\"buildingproductecosystems.org\") > 0  ? \"\" : '<p>Resources compiled by <a href=\"https://www.buildingproductecosystems.org/\">Building Product Ecosystems</a> | Please submit <a href=\"https://www.buildingproductecosystems.org/regional-reuse-resources#suggestions\">suggestions, additions, or corrections</a> here.</p>'}\n</div>\n\n<div class=\"table-wrapper\" style=\"display: ${hideTable ? \"none\" : \"block\"}\">\n  <table id=\"table\" class=\"stripe display responsive\" width=\"100%\"></table>\n</div>\n`\n\nconst init = async () => {\n  // Data.getSpreadsheetData()\n  let data = await Data.getAirtableData()\n  let airtableData = data[0]\n  const colorsData = data[1]\n\n  console.log(airtableData, colorsData);\n\n  Map.init(airtableData, colorsData);\n  Table.init(airtableData, '#table');\n\n  const mapLegend = document.querySelector('#mapLegend')\n  mapLegend.innerHTML = Map.mapLegend(colorsData)\n\n  const mapLegendShow = document.querySelector('#map-legend-show')\n  const mapLegendHide = document.querySelector('#map-legend-hide')\n  const mapLegendContent = document.querySelectorAll('.map-legend-content')\n\n  mapLegendShow.onclick = function () {\n    mapLegendShow.classList.add('invisible')\n    mapLegendShow.classList.remove('visible')\n    mapLegendHide.classList.add('visible')\n    mapLegendHide.classList.remove('invisible')\n    mapLegendContent.forEach(div => {\n        div.classList.add('visible')\n        div.classList.remove('invisible')\n    })\n  }\n  mapLegendHide.onclick = function () {\n    mapLegendShow.classList.remove('invisible')\n    mapLegendShow.classList.add('visible')\n    mapLegendHide.classList.remove('visible')\n    mapLegendHide.classList.add('invisible')\n    mapLegendContent.forEach(div => {\n        div.classList.remove('visible')\n        div.classList.add('invisible')\n    })\n  }\n}\n\nwindow.addEventListener('DOMContentLoaded', init)\n"],"sourceRoot":""}